<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <th:block th:replace="~{fragments/layout :: layout(~{::content})}">
    <th:block th:fragment="content">
      <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between mb-3 gap-3">
        <div>
          <h4 class="mb-0">Lojas</h4>
          <p class="text-muted mb-0">Cadastre novas lojas e ative/desative conforme necessário.</p>
        </div>
        <div class="btn-group" role="group">
          <a th:href="@{/admin/stores(status='ativos')}" class="btn btn-outline-success"
             th:classappend="${filter == 'ativos'} ? ' active'">
            Ativas
          </a>
          <a th:href="@{/admin/stores(status='inativos')}" class="btn btn-outline-success"
             th:classappend="${filter == 'inativos'} ? ' active'">
            Inativas
          </a>
          <a th:href="@{/admin/stores(status='todos')}" class="btn btn-outline-success"
             th:classappend="${filter == 'todos'} ? ' active'">
            Todas
          </a>
        </div>
      </div>

      <div class="row g-3 mb-4">
        <div class="col-12 col-lg-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Nova loja</h5>
              <form th:action="@{/admin/stores}" method="post" th:object="${formStore}">
                <div class="mb-3">
                  <label for="storeName" class="form-label">Nome</label>
                  <input id="storeName" type="text" class="form-control" th:field="*{name}"
                         th:classappend="${#fields.hasErrors('name')} ? ' is-invalid'" required>
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                </div>
                <div class="mb-3">
                  <label for="storeCnpj" class="form-label">CNPJ (opcional)</label>
                  <input id="storeCnpj" type="text" class="form-control" th:field="*{cnpj}"
                         th:classappend="${#fields.hasErrors('cnpj')} ? ' is-invalid'">
                  <div class="invalid-feedback" th:if="${#fields.hasErrors('cnpj')}" th:errors="*{cnpj}"></div>
                </div>
                <div class="form-check form-switch mb-3">
                  <input class="form-check-input" type="checkbox" id="storeActive" th:field="*{active}">
                  <label class="form-check-label" for="storeActive">Ativa</label>
                </div>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button class="btn btn-success w-100" type="submit">Cadastrar</button>
              </form>
            </div>
          </div>
        </div>
        <div class="col-12 col-lg-8">
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table align-middle mb-0">
                  <thead>
                    <tr>
                      <th>Nome</th>
                      <th>CNPJ</th>
                      <th>Status</th>
                      <th class="text-end">Ações</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="store : ${stores}">
                      <td th:text="${store.name}">Loja XPTO</td>
                      <td th:text="${store.cnpj} ?: '-'">00.000.000/0000-00</td>
                      <td>
                        <span class="badge" th:classappend="${store.active} ? ' text-bg-success' : ' text-bg-secondary'"
                              th:text="${store.active} ? 'Ativa' : 'Inativa'">Ativa</span>
                      </td>
                      <td class="text-end">
                        <form th:action="@{|/admin/stores/${store.id}/toggle|}" method="post" class="d-inline">
                          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                          <button type="submit" class="btn btn-sm"
                                  th:classappend="${store.active} ? 'btn-outline-danger' : 'btn-outline-success'"
                                  th:text="${store.active} ? 'Inativar' : 'Ativar'">
                            Inativar
                          </button>
                        </form>
                      </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(stores)}">
                      <td colspan="4" class="text-center text-muted py-4">Nenhuma loja encontrada.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </th:block>
  </th:block>
</html>
